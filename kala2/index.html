<!doctype html>
<html lang="en">
    <head>
        <meta charset="utf-8" />
        <title>Psychedelic Kaleidoscope – One File, Infinite Trip</title>
        <style>
            html,
            body {
                margin: 0;
                height: 100%;
                background: #000;
                overflow: hidden;
            }
            canvas {
                display: block;
                width: 100%;
                height: 100%;
            }
        </style>
    </head>
    <body>
        <canvas id="trip"></canvas>

        <script>
            /* ==============================================================
   PSYCHEDELIC KALEIDOSCOPE
   — No libraries, no inputs, no memory —
   Every frame springs from ✨ math + time ✨ alone.
   ============================================================== */

            ;(() => {
                const canvas = document.getElementById("trip")
                const ctx = canvas.getContext("2d")
                let w, h, cx, cy, dpr

                // Resize & high-DPI handling
                function resize() {
                    dpr = window.devicePixelRatio || 1
                    w = canvas.width = innerWidth * dpr
                    h = canvas.height = innerHeight * dpr
                    canvas.style.width = innerWidth + "px"
                    canvas.style.height = innerHeight + "px"
                    cx = w / 2
                    cy = h / 2
                    ctx.lineCap = "round"
                    ctx.lineJoin = "round"
                }
                window.addEventListener("resize", resize)
                resize()

                // Core animation loop
                function draw(t) {
                    t *= 0.001 // ms → s

                    // Fade previous frame for dreamy trails
                    ctx.fillStyle = "rgba(0,0,0,0.08)"
                    ctx.fillRect(0, 0, w, h)

                    const segments = 16 // radial slices
                    const segAngle = (2 * Math.PI) / segments
                    const baseRadius = Math.min(w, h) * 0.4
                    const freq1 = 3
                    const freq2 = 7

                    ctx.save()
                    ctx.translate(cx, cy)

                    for (let i = 0; i < segments; i++) {
                        ctx.save()
                        ctx.rotate(i * segAngle)

                        // Mirror every other segment for bilateral chaos
                        if (i % 2) ctx.scale(1, -1)

                        // Dynamic hue per segment + time
                        const hue = (t * 40 + i * (360 / segments)) % 360
                        ctx.strokeStyle = `hsl(${hue}, 85%, 60%)`
                        ctx.shadowColor = `hsla(${hue}, 85%, 60%, 0.6)`
                        ctx.shadowBlur = 20

                        ctx.lineWidth = 1.5 + Math.sin(t + i) * 1.2
                        ctx.beginPath()

                        // Parametric wiggle: r(θ) = base + sin/cos nests
                        const steps = 400
                        for (let s = 0; s <= steps; s++) {
                            const pct = s / steps
                            const theta = pct * Math.PI * 2

                            // Radial distance evolves with stacked sines
                            const r =
                                baseRadius *
                                (0.55 +
                                    0.25 * Math.sin(freq1 * theta + t * 1.5) +
                                    0.2 * Math.cos(freq2 * theta - t))

                            const x = r * Math.cos(theta)
                            const y = r * Math.sin(theta)

                            if (s === 0) ctx.moveTo(x, y)
                            else ctx.lineTo(x, y)
                        }
                        ctx.closePath()
                        ctx.stroke()
                        ctx.restore()
                    }

                    ctx.restore()
                    requestAnimationFrame(draw)
                }

                requestAnimationFrame(draw)
            })()
        </script>
    </body>
</html>
